# budgetapi
An API to track spendings.

# Starting the app
To start the service:  
1. clone the repo and `cd` into the cloned directory
2. run `docker-compose up -d`

# Services
The app consists of several containerized services:
- *api* - Main point of interaction with the app - an API build with Django and Django REST Framework. Runs on http://localhost:8000 by default.
- *postgres* - Postgres database - the app's persistent storage.
- *celery* - A Celery instance to execute tasks asyncronously.
- *celerybeat* - Task scheduler to schedule daily emails with user's budget summary.
- *flower* - UI to monitor Celery tasks. By default runs on http://localhost:5555.
- *redis* - message broker used by Celery to distribute tasks.

# Admin site
You can access the admin interface at http://localhost:8000/admin/. Use *root* for both username and password.

# Browsable API and token authorization
To access the browsable API go to either http://localhost:8000 or directly to the login page at http://localhost:8000/api/auth/login/.

When app is started, both **root** and **testuser** accounts with fake data are generated.  
Use *testuser* for login and *1234test* for password to login as **testuser**,  or *root* for both login and password to login as **root**. The **root** can access each user's data and and has full CRUD permissions.

If you want to create a new account for yourself - go to http://localhost:8000/api/v1/auth/registration/ to register and receive your authentication token.  

If you want to access the API programmatically you need to go to http://localhost:8000/api/v1/auth/login/ and make a *POST* request with user data to receive an authentication token. Emails to use for autogenerated users: **root** - *root@example.com*, **testuser** - *testuser@example.com*.
Remember to always send the token with your request if you are going to access the API programmatically.

# API endpoints reference
The app exposes several documentation endpoints that provide detailed information about the API.

You can download YAML-formatted schema by going to http://localhost:8000/api/schema.

For dynamic schema and list of all endpoints you can visit http://localhost:8000/api/schema/redoc/ for ReDoc or http://localhost:8000/api/schema/swagger/ for Swagger UI.

# Filtering and sorting transactions
You can filter and sort your transactions list at http://localhost:8000/api/v1/transactions/ by using the HTML `Filter` controls in the upper corner of the Browsable API's page.

# Retrieving budget statistics
You can retrieve specialized info about the state of your budget by appending the following query strings to http://localhost:8000/api/v1/transactions/stats/:
- `?mode=balance` - current balance
- `?mode=summary` - overview of all your transactions
- `?mode=monthly` - monthly balance
- `?mode=categories` - balance per category
- `?mode=companies` - balance per company
- `?mode=week` - summary of current week's transactions

# Daily budget summary email
By default budget summary emails are sent to each user at 9 a.m. UTC and use Django's console email backend. To make sure that emails are sent and to review their content you can inspect the celery worker logs with `docker logs celery` and beat scheduler logs with `docker logs celeryapp` or go to `localhost:5555` to browse tasks using flower UI.

You can change the periodicity by tweaking the settings for the 'send_emails' task in CELERY_BEAT_SCHEDULE config in `budgetapi/settings.py`.

You can also schedule tasks manually by using Django shell.

# Configuring the app
You can configure the app by overwriting the environment variables used in `docker-compose.yml` and `budgetapi.settings` module.